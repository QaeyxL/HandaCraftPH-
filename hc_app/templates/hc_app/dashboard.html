{% extends 'hc_app/base.html' %}
{% load static %}
{% block title %}Vendor Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'hc_app/dashboard.css' %}">
{% endblock %}

{% block content %}
<h1>Vendor Dashboard -- Shipping & Order Fulfillment</h1>

<div class="container">
    <div class="div1">
        <h2>Customers</h2>
        <div class="stat-value">{{ total_customers }}</div>   <!-- edit22 - edit <div class="stat-value">0</div>-->
    </div>

    <div class="div2">
        <h2>Orders</h2>
        <div class="stat-value">{{ total_orders }}</div>   <!-- edit22 - edit <div class="stat-value">0</div>-->
    </div>

    <div class="div3">
        <h2>Monthly Sales</h2>
        <div class="chart-placeholder">Sync Graph later</div>
    </div>

    <div class="div4">
        <h2>Monthly Target + Order Cap</h2>
        <div class="chart-placeholder">[Target vs Actual]</div>
    </div>

    <div class="div5">
        <h2>Customer Demographics</h2>
        <div id="ph-map"></div>
        <div id="ph-legend" class="map-legend" aria-hidden="false"></div>
    </div>

    <div class="div6">
        <h2>Recent Orders</h2>
        <ul>
            {% for order in recent_orders %}   <!-- edit22 - edited <li>Order #0000 -- </li>-->
                <li>Order #{{ order.id }} â€” {{ order.status }}</li>
            {% empty %}
                <li>No recent orders</li>
            {% endfor %}
        </ul>
    </div>

    <div class="div8">
        <h2>My Listings</h2>   <!-- edit22 - added -->
        <ul>
            {% for product in user_products %}
                <a href="{% url 'hc_app:product_detail' product.id %}">{{ product.name }}</a>
            {% empty %}
                <li>No products listed yet.</li>
            {% endfor %}
        </ul>
    </div>


    <div class="div7">
        <h2>Customer Inquiries</h2>
        <div class="chat-container">
            <div class="chat-list">    
                {% for user in users %}  <!-- edit22 - edited <div class="chat-user" data-user="1">Fn. Ln.</div> -->
                    <div class="chat-user">
                        <span>{{ user.username }}</span>
                        <form method="post" action="{% url 'hc_app:message_user' user.id %}" class="d-flex gap-2 mt-1">
                            {% csrf_token %}
                            <input type="text" name="message" placeholder="Type a message..." class="form-control form-control-sm" required>
                            <button type="submit" class="btn btn-sm btn-primary">Send</button>
                        </form>
                    </div>
                {% endfor %}
            </div>

            <div class="chat-window hidden">
                <div class="chat-header">
                    <span class="chat-username">Select a chat</span>
                </div>

                <div class="messages">
                    {% for q in recent_quotes %}   <!-- edit22 - added -->
                        <div class="mb-2">
                        <strong>{{ q.buyer.username }}</strong>: {{ q.message }}
                        <small class="text-muted">({{ q.created_at|date:"Y-m-d H:i" }})</small>
                        </div>
                    {% empty %}
                        <p>No quotes yet.</p>
                    {% endfor %}
                </div>

                <div class="chat-input">
                    <input type="text" placeholder="Type a message...">
                    <button>Send</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'hc_app/scripts/dashboard.js' %}"></script>
{% endblock %}
