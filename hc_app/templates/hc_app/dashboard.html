{% extends 'hc_app/base.html' %}
{% load static %}
{% block title %}Vendor Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'hc_app/dashboard.css' %}">
{% endblock %}

{% block content %}
<h1>Vendor Dashboard -- Shipping & Order Fulfillment</h1>

<div class="container">
    <div class="div1">
        <h2>Customers</h2>
        <div class="stat-value">{{ total_customers }}</div>   <!-- edit22 - edit <div class="stat-value">0</div>-->
    </div>

    <div class="div2">
        <h2>Orders</h2>
        <div class="stat-value">{{ total_orders }}</div>   <!-- edit22 - edit <div class="stat-value">0</div>-->
    </div>

    <div class="div3">
        <h2>Monthly Sales</h2>
        <div class="chart-placeholder">Sync Graph later</div>
    </div>

    <div class="div4">
        <h2>Monthly Target + Order Cap</h2>
        <div class="chart-placeholder">[Target vs Actual]</div>
    </div>

    <div class="div5">
        <h2>Customer Demographics</h2>
        <div id="ph-map"></div>
        <div id="ph-legend" class="map-legend" aria-hidden="false"></div>
    </div>

    <div class="div6">
        <h2>Recent Orders</h2>   <!-- edit22 - edited -->
        <ul>
            {% for order in recent_orders %}
                <li>
                    Order #{{ order.id }} â€” {{ order.status }}

                    <form method="post" action="{% url 'hc_app:update_order_status' order.id %}" class="d-inline">
                        {% csrf_token %}
                        <select name="status" class="form-select form-select-sm d-inline w-auto">
                            {% for s in statuses %}
                                <option value="{{ s }}" {% if order.status == s %}selected{% endif %}>{{ s }}</option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="btn btn-sm btn-outline-primary">Update</button>
                    </form>
                </li>
            {% empty %}
                <li>No recent orders</li>
            {% endfor %}
        </ul>
    </div>

    <div class="div8">
        <h2>My Listings</h2>   <!-- edit22 - added -->
        <ul>
            {% for product in user_products %}
                <li>
                    <a href="{% url 'hc_app:product_detail' product.id %}">{{ product.name }}</a>
                </li>
            {% empty %}
                <li>No products listed yet.</li>
            {% endfor %}
        </ul>
    </div>


    <div class="div7">
        <h2>Customer Inquiries</h2>
        <div class="chat-container">
            <div class="chat-list">    
                {% for user in users %}  <!-- edit22 - edited <div class="chat-user" data-user="1">Fn. Ln.</div> -->
                    <div class="chat-user" data-user="{{ user.id }}">
                        <span>{{ user.username }}</span>
                        <form method="post" action="{% url 'hc_app:message_user' user.id %}" class="d-flex gap-2 mt-1">
                            {% csrf_token %}
                            <input type="text" name="message" placeholder="Type a message..." class="form-control form-control-sm" required>
                            <button type="submit" class="btn btn-sm btn-primary">Send</button>
                        </form>
                    </div>
                {% endfor %}
            </div>

            <div class="chat-window hidden">
                <div class="chat-header">
                    <span class="chat-username">Select a chat</span>
                </div>

                <div class="messages">
                    {% for quote in recent_quotes %}
                        <div class="chat-message">
                            <div class="chat-message-header">
                                <span class="chat-message-date">{{ quote.created_at|date:"F j, Y" }}</span>
                            </div>
                            <div class="chat-message-body">
                                <p>{{ quote.message }}</p>
                            </div>
                        </div>
                    {% empty %}
                        <p>No quotes yet.</p>
                    {% endfor %}
                </div>

                <div class="chat-input">
                    <input type="text" placeholder="Type a message...">
                    <button>Send</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'hc_app/scripts/dashboard.js' %}"></script>
{% endblock %}
